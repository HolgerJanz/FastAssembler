; Test Suite for FA SpartaDOS X 4.50
;   without extended memory
; Use: -TEST_SDX
; Requires:
;  FA.COM in path,<TESTS,<EXAMPLES,<SOURCES,<SDXLIB
; Assembles ASM files,
; compares OBJ/SYM files with COM/TXT files,
; checks for expected errors
ECHO ON
LOAD COMMAND.COM
LOAD <BIN>FA.COM
LOAD <BIN>TSTCOMP.COM
;===================================
; BEGIN FA Test Suite
;===================================
SETERRNO 0
ERROR ON
;===================================
; Test Parameter, Summary, and List

FA

ERROR OFF
FA /LSQ ERROR1 /LS ERROR2.XXX Z
IF NOT ERROR 156
 EXIT
FI
SETERRNO 0
ERROR ON

FA TESTSYMB.ASM /LQ

FA TESTSYMB.ASM /SQ

FA /SQ TESTSYMB.ASM /L

;===================================
; Test Statements

FA /EQ TEST6502.ASM
TSTCOMP TEST6502.COM TEST6502.OBJ

FA /EQ TESTBLCK.ASM
TSTCOMP TESTBLCK.COM TESTBLCK.OBJ

FA /EQ TESTCOMP.ASM
TSTCOMP TESTCOMP.COM TESTCOMP.OBJ

FA /EQ TESTEND.ASM
TSTCOMP TESTEND.COM TESTEND.OBJ

FA /EQ TESTEXPR.ASM
TSTCOMP TESTEXPR.COM TESTEXPR.OBJ

FA /EQ TESTINC.ASM
TSTCOMP TESTINC.COM TESTINC.OBJ

FA /EQ TESTINC2.ASM
TSTCOMP TESTINC2.COM TESTINC2.OBJ

FA /EQ TESTLABE.ASM
TSTCOMP TESTLABE.COM TESTLABE.OBJ

FA /EQ TESTMAXP.ASM
TSTCOMP TESTMAXP.COM TESTMAXP.OBJ

FA /EQ TESTMCLR.ASM
TSTCOMP TESTMCLR.COM TESTMCLR.OBJ

FA /EQ TESTPSDO.ASM
TSTCOMP TESTPSDO.COM TESTPSDO.OBJ

FA /EQ TESTSYMB.ASM
TSTCOMP TESTSYMB.COM TESTSYMB.OBJ

FA /EQ TESTINS.ASM
TSTCOMP TESTINS.COM TESTINS.OBJ

FA /EQ TESTORG1.ASM
TSTCOMP TESTORG1.COM TESTORG1.OBJ

FA /EQ TESTORG2.ASM
TSTCOMP TESTORG2.COM TESTORG2.OBJ

FA /EQ TESTBLK1.ASM
TSTCOMP TESTBLK1.COM TESTBLK1.OBJ

FA /EQ TESTPADD.ASM
TSTCOMP TESTPADD.COM TESTPADD.OBJ

;===================================
; Test Compile Errors

ERROR OFF

; Undeclared label
FA ERRORURS /EQ
IF NOT ERROR 224
 EXIT
FI
SETERRNO 0

; Label recursion
FA errorrec /EQ
IF NOT ERROR 224
 EXIT
FI
SETERRNO 0

; Declared twice
FA error225 /EQ
IF NOT ERROR 225
 EXIT
FI
SETERRNO 0

; Unexpected eol
FA error226 /EQ
IF NOT ERROR 226
 EXIT
FI
SETERRNO 0

; Too many passes
FA /EQ error228
IF NOT ERROR 228
 EXIT
FI
SETERRNO 0

; Too many passes
FA /EQ error227
IF NOT ERROR 227
 EXIT
FI
SETERRNO 0

; String error
FA /EQ error229
IF NOT ERROR 229
 EXIT
FI
SETERRNO 0

; Branch too far
FA /EQ error231
IF NOT ERROR 231
 EXIT
FI
SETERRNO 0

; Improper type (2)
FA ERRORN2 /EQ
IF NOT ERROR 232
 EXIT
FI
SETERRNO 0

; Branch too far ERROR233.ASM
FA error233 /EQ
IF NOT ERROR 233
 EXIT
FI
SETERRNO 0

; Too long or invalid symbol
FA error238 /EQ
IF NOT ERROR 238
 EXIT
FI
SETERRNO 0

; Program counter overflow
FA error243 /EQ
IF NOT ERROR 243
 EXIT
FI
SETERRNO 0

; Truncated line
FA error245 /EQ
IF NOT ERROR 245
 EXIT
FI
SETERRNO 0

; Truncated line
FA error246 /EQ
IF NOT ERROR 245
 EXIT
FI
SETERRNO 0

; Padding program counter overflow
FA errorpad /EQ
IF NOT ERROR 243
 EXIT
FI
SETERRNO 0

; Check messages and code position
FA testemsg /Q >>testemsg.trc
TSTCOMP TESTEMSX.TXT TESTEMSG.TRC
IF ERROR
 EXIT
FI
SETERRNO 0

DEL *.OBJ
DEL *.TRC

ERROR ON

;===================================
; Test Examples

CD <EXAMPLES>

FA /EQ COMP_SDX
TSTCOMP COMP_SDX.COM COMP_SDX.OBJ

FA /EQ CALLEE
TSTCOMP CALLEE.COM CALLEE.OBJ

FA /EQ COMP_BWD
TSTCOMP COMP_BWD.COM COMP_BWD.OBJ

FA /EQ COMP_SDX
TSTCOMP COMP_SDX.COM COMP_SDX.OBJ

FA /EQ GTIA
TSTCOMP GTIA.COM GTIA.OBJ

FA /EQ HELLO
TSTCOMP HELLO.COM HELLO.OBJ

FA /EQ HI_BWD
TSTCOMP HI_BWD.COM HI_BWD.OBJ

FA /EQ HI_SDX
TSTCOMP HI_SDX.COM HI_SDX.OBJ

FA /EQ HSCROL
TSTCOMP HSCROL.COM HSCROL.OBJ

FA /EQ MY_COMP
TSTCOMP MY_COMP.COM MY_COMP.OBJ

FA /EQ POKEY
TSTCOMP POKEY.COM POKEY.OBJ

FA /EQ RAINBOW /Y
TSTCOMP RAINBOW.COM RAINBOW.OBJ
TSTCOMP <TESTS>RAINBOWS.TXT RAINBOW.SYM

FA /EQ TSR_CALL
TSTCOMP TSR_CALL.COM TSR_CALL.OBJ

FA /EQ TSR
TSTCOMP TSR.COM TSR.OBJ

DEL *.OBJ
DEL *.SYM

FA /EQ CART8K
TSTCOMP CART8K.ROM CART8K.OBJ

DEL *.OBJ

;===================================
; Test SDX lib

CD <SDXLIB>

FA /EQ TESTCOPY
TSTCOMP TESTCOPY.COM TESTCOPY.OBJ

FA /EQ TESTFILE
TSTCOMP TESTFILE.COM TESTFILE.OBJ

FA /EQ TESTGETN
TSTCOMP TESTGETN.COM TESTGETN.OBJ

FA /EQ TESTMUDI
TSTCOMP TESTMUDI.COM TESTMUDI.OBJ

FA /EQ TESTPRNF
TSTCOMP TESTPRNF.COM TESTPRNF.OBJ

FA /EQ TESTSLSH
TSTCOMP TESTSLSH.COM TESTSLSH.OBJ

DEL *.OBJ

;===================================
; Test FastAssembler itself

CD <SOURCES>

FA /EQ FA_SDX
TSTCOMP <BIN>FA.COM FA_SDX.OBJ

FA /EQ FA_BWD
TSTCOMP <DOS>FA.COM FA_BWD.OBJ

DEL *.OBJ

;===================================
; END FA Test Suite
;===================================
CD <TESTS>
LOAD
EXIT
